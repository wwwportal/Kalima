# Kalima Repository Structure

## Root Directory
```
Kalima/
├── Kalima.exe          # Desktop application executable (20MB)
├── kalima.db           # SQLite database (33MB, generated by ingest)
├── kalima-index/       # Tantivy search index (generated by ingest)
├── datasets/           # Source data for ingestion
├── engine/             # Rust backend (4 crates)
├── src-tauri/          # Tauri desktop wrapper
├── static/             # Frontend assets (HTML, CSS, JS)
├── README.md           # Project documentation
├── CHANGELOG.md        # Version history
└── .gitignore          # Git ignore rules
```

## Core Components

### 1. Desktop Application
- **Kalima.exe** - Tauri-wrapped desktop app
  - Embeds Rust API server
  - Opens native window
  - Loads from kalima.db and kalima-index/

### 2. Backend (engine/)
```
engine/
├── kalima-api/         # Web server + API endpoints
│   ├── src/
│   │   ├── lib.rs      # Server library (start_server())
│   │   ├── main.rs     # CLI entry point
│   │   └── bin/ingest.rs  # Data ingestion tool
│   └── Cargo.toml
├── kalima-core/        # Core types and traits
├── kalima-store/       # SQLite storage backend
├── kalima-index/       # Tantivy search backend
└── Cargo.toml          # Workspace configuration
```

### 3. Frontend (static/)
```
static/
├── index.html          # Main HTML
├── css/
│   └── minimal.css     # Styles
└── js/                 # 17 modular JavaScript files
    ├── app*.js         # Application logic
    └── canvas*.js      # Canvas rendering
```

### 4. Desktop Wrapper (src-tauri/)
```
src-tauri/
├── src/
│   ├── lib.rs          # Tauri setup, path configuration
│   └── main.rs         # Entry point
├── tauri.conf.json     # Tauri configuration
├── Cargo.toml          # Dependencies
└── icons/              # Application icons
```

### 5. Data (datasets/)
```
datasets/
└── corpus/
    └── quran.jsonl     # Source corpus (6,236 verses, 23MB)
```

## Data Flow

1. **Ingestion** (one-time):
   ```
   datasets/corpus/quran.jsonl
     → ingest tool
       → kalima.db (SQLite)
       → kalima-index/ (Tantivy)
   ```

2. **Desktop App Launch**:
   ```
   Kalima.exe
     → starts kalima_api::start_server()
       → loads kalima.db
       → loads kalima-index/
       → serves static/
     → opens Tauri window at http://127.0.0.1:8080
   ```

3. **API Request**:
   ```
   Frontend (static/js)
     → HTTP request to localhost:8080/api/verse/1/1
       → kalima-store queries SQLite
       → returns verse with tokens/segments
     → Frontend renders verse
   ```

## What's NOT Needed

The following were removed as unused:
- ~~archive/~~ (old CSS)
- ~~schema/~~ (outdated)
- ~~deploy/~~ (server configs, not needed for desktop)
- ~~Dockerfile, docker-compose.yml~~ (not needed for desktop)
- ~~*.backup files~~ (backups)
- ~~nul files~~ (Windows artifacts)

## Build Commands

```bash
# First-time setup
cd engine
cargo run --release --bin ingest -- --db ../kalima.db --index ../kalima-index --input ../datasets/corpus/quran.jsonl

# Build desktop app
cargo tauri build
cp src-tauri/target/release/app.exe Kalima.exe

# Run desktop app
./Kalima.exe
```
